{% extends 'public/base.html.twig' %}

{% block title %}Ana Sayfa{% endblock %}

{% block header %}
<header style="position:sticky;top:0;z-index:60;background:#0a0a0a;border-bottom:1px solid #1a1a1a;">
  <div style="max-width:80%;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;color:#fff;">
    <a href="{{ path('public_home') }}" style="display:flex;align-items:center;text-decoration:none;color:#fff;">
      <img src="{{ asset('mineindustries_logo_transparent_pad8.png') }}" alt="Makine Ticaret" style="height:44px;width:auto;border-radius:6px;object-fit:contain;display:block;"/>
    </a>
    <nav style="display:flex;gap:22px;align-items:center;">
      <a href="{{ path('public_products') }}" style="color:#e5e5e5;text-decoration:none;font-weight:600;font-size:14px;">Ürünler</a>
      <a href="{{ path('public_companies') }}" style="color:#bdbdbd;text-decoration:none;font-size:14px;">Firmalar</a>
      <a href="{{ path('public_categories') }}" style="color:#bdbdbd;text-decoration:none;font-size:14px;">Kategoriler</a>
      <a href="{{ path('public_bids') }}" style="color:#bdbdbd;text-decoration:none;font-size:14px;">İhaleler</a>
      <a href="{{ path('purchase_request_new') }}" style="color:#111111;background:#C0C0C0;text-decoration:none;font-size:13px;font-weight:700;padding:6px 10px;border-radius:8px;">Alım Talebi Oluştur</a>
      {% if app.user %}
        <div style="position:relative;" id="userMenuRoot">
          <button id="userMenuButton" style="display:flex;align-items:center;gap:8px;background:transparent;border:0;color:#e5e5e5;cursor:pointer;font-size:14px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>{{ (app.user.name ~ ' ' ~ app.user.surname)|trim ?: (app.user.username ?? app.user.email) }}</span>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div id="userMenuDropdown" style="display:none;position:absolute;right:0;top:calc(100% + 8px);background:#111214;border:1px solid #222428;border-radius:8px;min-width:180px;box-shadow:0 8px 24px rgba(0,0,0,.35);">
            <a href="{{ path('user_messages_inbox') }}" style="display:flex;align-items:center;gap:8px;padding:10px 12px;color:#e5e5e5;text-decoration:none;font-size:14px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16v16H4z" fill="none"/><path d="M22 6l-10 7L2 6"/></svg>
              <span>Mesajlarım</span>
            </a>
            <a href="{{ path('purchase_request_new') }}" style="display:flex;align-items:center;gap:8px;padding:10px 12px;color:#e5e5e5;text-decoration:none;font-size:14px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
              <span>Alım Talebi Oluştur</span>
            </a>
            {% if 'ROLE_SUBSCRIBER' in app.user.roles %}
            <a href="{{ path('admin_dashboard') }}" style="display:flex;align-items:center;gap:8px;padding:10px 12px;color:#e5e5e5;text-decoration:none;font-size:14px;border-top:1px solid #1e2024;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              <span>İhale Oluştur</span>
            </a>
            {% endif %}
            <a href="{{ path('app_logout') }}" style="display:flex;align-items:center;gap:8px;padding:10px 12px;color:#ff7b7b;text-decoration:none;font-size:14px;border-bottom-left-radius:8px;border-bottom-right-radius:8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><path d="M10 17l5-5-5-5"/><path d="M15 12H3"/></svg>
              <span>Çıkış Yap</span>
            </a>
          </div>
        </div>
        <script>
          (function(){
            var btn = document.getElementById('userMenuButton');
            var dd = document.getElementById('userMenuDropdown');
            var root = document.getElementById('userMenuRoot');
            if (!btn || !dd || !root) return;
            btn.addEventListener('click', function(e){
              e.stopPropagation();
              dd.style.display = dd.style.display === 'none' || dd.style.display === '' ? 'block' : 'none';
            });
            document.addEventListener('click', function(e){
              if (!root.contains(e.target)) { dd.style.display = 'none'; }
            });
          })();
        </script>
      {% else %}
        <a href="{{ path('app_login') }}" style="color:#bdbdbd;text-decoration:none;font-size:14px;">Giriş Yap</a>
        <a href="{{ path('app_register') }}" style="color:#e5e5e5;text-decoration:none;font-weight:600;font-size:14px;">Kayıt Ol</a>
      {% endif %}
    </nav>
  </div>
</header>
{% endblock %}

{% block body %}
<style>
  .hero-video {
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    background: #000;
  }
  .hero-video video {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .hero-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    padding: 24px 32px;
    background: linear-gradient(to top, rgba(0,0,0,.55) 0%, rgba(0,0,0,0) 60%);
    color: #fff;
  }
  .category-section {
    background: #ffffff;
    color: #fff;
    padding: 48px 0 80px;
    transition: background-color .35s ease;
  }
  .category-section.is-dark { background: #0a0a0a; }
  .container {
    max-width: 80%;
    margin: 0 auto;
    padding: 0 16px;
  }
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 24px;
  }
  @media (max-width: 720px) { .cards-grid { grid-template-columns: 1fr; gap: 16px; } }
  .model-card {
    position: relative;
    background: #111;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    isolation: isolate;
  }
  .model-card img,
  .model-card video {
    display: block;
    width: 100%;
    height: 680px;
    object-fit: cover;
    transition: opacity .35s ease;
  }
  @media (max-width: 1280px) {
    .model-card img,
    .model-card video { height: 620px; }
  }
  @media (max-width: 1024px) {
    .model-card img,
    .model-card video { height: 560px; }
  }
  @media (max-width: 720px) {
    .model-card img,
    .model-card video { height: 360px; }
  }
  .model-card video { position: absolute; inset: 0; opacity: 0; }
  .model-card:hover video { opacity: 1; }
  .model-card:hover img { opacity: 0; }

  .model-info {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 20px 24px;
    color: #fff;
    background: linear-gradient(to top, rgba(0,0,0,.55) 0%, rgba(0,0,0,0) 60%);
    pointer-events: none;
  }
  .badge {
    align-self: flex-start;
    background: rgba(255,255,255,.16);
    color: #fff;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
  }
  .model-title {
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
    font-weight: 800;
    font-style: italic;
    font-size: 42px;
    letter-spacing: 2px;
    text-shadow: 0 2px 12px rgba(0,0,0,.5);
  }
  .model-desc {
    font-size: 14px;
    opacity: .9;
    max-width: 640px;
  }
  .arrow {
    font-size: 20px;
  }

  /* Reveal animations */
  .reveal { opacity: 0; transform: translateY(24px); transition: opacity .6s ease, transform .6s ease; }
  .reveal.from-left { transform: translateX(-28px); }
  .reveal.from-right { transform: translateX(28px); }
  .reveal.visible { opacity: 1; transform: translate(0,0); }
</style>

<section class="hero-video">
  <video src="/Maden.mp4" autoplay muted loop playsinline></video>
  <div class="hero-overlay">
    <div>
      <div class="badge">mineindestries</div>
{#      <h2 style="margin:8px 0 0;font-size:28px;font-weight:600">Porsche yolculuğunuz şimdi başlıyor.</h2>#}
    </div>
  </div>
  </section>

<!-- Kayan Logolar Bölümü -->
<section class="sliding-logos-section">
  <div class="sliding-logos-container">
    <div class="sliding-logos-track">
      <!-- İlk grup logolar -->
      <div class="sliding-logos-group">
        <img src="{{ asset('FirmaPng/0284c1788a11165bd29a078c2ed15484.webp') }}" alt="Logo 1" class="sliding-logo">
        <img src="{{ asset('FirmaPng/34-346773_general-electric-hd-png-download.png') }}" alt="General Electric" class="sliding-logo">
        <img src="{{ asset('FirmaPng/avo4nfcls.webp') }}" alt="Logo 3" class="sliding-logo">
        <img src="{{ asset('FirmaPng/avtwd8flx.webp') }}" alt="Logo 4" class="sliding-logo">
        <img src="{{ asset('FirmaPng/images (1).png') }}" alt="Logo 5" class="sliding-logo">
        <img src="{{ asset('FirmaPng/komatsu-logo-kr0M2jTZ_t.jpg') }}" alt="Komatsu" class="sliding-logo">
        <img src="{{ asset('FirmaPng/nipponsteel.png') }}" alt="Nippon Steel" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-ab-volvo-volvo-cars-volvo-s60-car-trademark-logo-car.png') }}" alt="Volvo" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-hitachi-logo-thumbnail.png') }}" alt="Hitachi" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-siemens-building-technologies-siemens-sector-industry-organization-siemens-corporation-saab-automobile-miscellaneous-blue-text-thumbnail.png') }}" alt="Siemens" class="sliding-logo">
      </div>
      <!-- İkinci grup logolar (tekrar) -->
      <div class="sliding-logos-group">
        <img src="{{ asset('FirmaPng/0284c1788a11165bd29a078c2ed15484.webp') }}" alt="Logo 1" class="sliding-logo">
        <img src="{{ asset('FirmaPng/34-346773_general-electric-hd-png-download.png') }}" alt="General Electric" class="sliding-logo">
        <img src="{{ asset('FirmaPng/avo4nfcls.webp') }}" alt="Logo 3" class="sliding-logo">
        <img src="{{ asset('FirmaPng/avtwd8flx.webp') }}" alt="Logo 4" class="sliding-logo">
        <img src="{{ asset('FirmaPng/images (1).png') }}" alt="Logo 5" class="sliding-logo">
        <img src="{{ asset('FirmaPng/komatsu-logo-kr0M2jTZ_t.jpg') }}" alt="Komatsu" class="sliding-logo">
        <img src="{{ asset('FirmaPng/nipponsteel.png') }}" alt="Nippon Steel" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-ab-volvo-volvo-cars-volvo-s60-car-trademark-logo-car.png') }}" alt="Volvo" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-hitachi-logo-thumbnail.png') }}" alt="Hitachi" class="sliding-logo">
        <img src="{{ asset('FirmaPng/png-transparent-siemens-building-technologies-siemens-sector-industry-organization-siemens-corporation-saab-automobile-miscellaneous-blue-text-thumbnail.png') }}" alt="Siemens" class="sliding-logo">
      </div>
    </div>
  </div>
</section>

<style>
  .sliding-logos-section {
    background: #f8fafc;
    padding: 80px 0;
    overflow: hidden;
    position: relative;
  }
  
  .sliding-logos-container {
    width: 100%;
    position: relative;
    z-index: 1;
  }
  
  .sliding-logos-track {
    display: flex;
    animation: slide 35s linear infinite;
    gap: 80px;
    align-items: center;
  }
  
  .sliding-logos-group {
    display: flex;
    gap: 80px;
    align-items: center;
    flex-shrink: 0;
  }
  
  .sliding-logo {
    height: 70px;
    width: auto;
    max-width: 160px;
    object-fit: contain;
    filter: none;
    opacity: 0.8;
    transition: all 0.4s ease;
  }
  
  .sliding-logo:hover {
    opacity: 1;
    transform: scale(1.15) translateY(-2px);
  }
  
  @keyframes slide {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
  
  @media (max-width: 768px) {
    .sliding-logos-section {
      padding: 60px 0;
    }
    
    .sliding-logos-track {
      gap: 60px;
    }
    
    .sliding-logos-group {
      gap: 60px;
    }
    
    .sliding-logo {
      height: 55px;
      max-width: 130px;
    }
  }
  
  @media (max-width: 480px) {
    .sliding-logos-section {
      padding: 50px 0;
    }
    
    .sliding-logos-track {
      gap: 50px;
    }
    
    .sliding-logos-group {
      gap: 50px;
    }
    
    .sliding-logo {
      height: 45px;
      max-width: 110px;
    }
  }
</style>

<style>
  .refs-section { background:#edf1f7; padding:64px 0 68px; }
  .refs-shell { max-width:1600px; margin:0 auto; padding:0 20px; }
  .refs-heading { text-align:center; color:#334155; font-size:14px; font-weight:900; letter-spacing:.2px; margin-bottom:22px; }
  .refs-row { display:flex; align-items:center; justify-content:space-between; gap:44px; filter:grayscale(1); opacity:.9; }
  .refs-logo { height:32px; display:flex; align-items:center; }
  .refs-logo svg { height:100%; width:auto; fill:#6b7280; }
  .refs-row:hover { filter:grayscale(.2); opacity:1; }
  @media (max-width: 1024px) { .refs-row { gap:28px; } }
  @media (max-width: 900px) { .refs-row { overflow-x:auto; justify-content:flex-start; padding-bottom:8px; } }
</style>

<section class="refs-section">
  <div class="refs-shell">
      <div class="refs-heading">Trusted by 2,800+ Leading Industry Companies</div>
      <div class="refs-row">
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".5">aperam</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="700" letter-spacing=".4">SQM</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="700" letter-spacing=".4">ArcelorMittal</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".6">GMH</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".6">greenlion</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="18" font-weight="900" letter-spacing="1">Metso</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="700" letter-spacing=".3">outokumpu</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 160 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".6">AngloAmerican</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".6">RHI</text></svg>
        </div>
        <div class="refs-logo">
          <svg viewBox="0 0 120 24" aria-hidden="true"><text x="0" y="17" font-size="16" font-weight="800" letter-spacing=".6">aperam</text></svg>
        </div>
      </div>
  </div>
</section>

<section class="category-section" id="categorySection">
  <div class="container">
    <div class="cards-grid">
      {% set demoVideos = [
        '/Kimyasal Ve Hammadde.mp4',
        '/Maden.mp4',
        '/Metal.mp4',
        '/OFİS.mp4',
        '/Otomasyon ve Tekstil.mp4',
        '/Tarım.mp4'
      ] %}
      {% for category in categories %}
        {% set v = demoVideos[loop.index0 % demoVideos|length] %}
        <a href="{{ path('public_products', {category: category.id}) }}" style="text-decoration:none;color:inherit;">
        <article class="model-card reveal {{ loop.index is odd ? 'from-left' : 'from-right' }}" data-title="{{ category.name }}">
          <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1600&auto=format&fit=crop" alt="{{ category.name }}">
          <video src="{{ v }}" muted preload="none"></video>
          <div class="model-info">
            <div></div>
            <div>
{#              <div class="badge">Benzin</div>#}
              <div class="model-title">{{ category.name }}</div>
{#              <p class="model-desc">Bu bir örnek açıklamadır. Üzerine geldiğinizde video oynar.</p>#}
              <div class="arrow">→</div>
            </div>
          </div>
        </article>
        </a>
      {% else %}
        <p>Kategori bulunamadı.</p>
      {% endfor %}
    </div>
  </div>
</section>

{# Purchase Requests Section #}
{% set purchaseRequests = purchaseRequests is defined ? purchaseRequests : [] %}
{% if purchaseRequests is not empty %}
<section class="purchase-requests-section">
  <div class="purchase-requests-shell">
    <div class="purchase-requests-head">
      <div>
        <div class="purchase-requests-title">Alım Talepleri</div>
        <div class="purchase-requests-sub">Admin onaylı alım talepleri</div>
      </div>
    </div>
    <div class="purchase-requests-table">
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-800/50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Tarih</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Ürün Adı</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Açıklama</th>
            
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">İşlemler</th>
          </tr>
        </thead>
        <tbody>
          {% for pr in purchaseRequests %}
            <tr class="reveal">
              <td class="date-cell">{{ pr.date|date('d.m.Y H:i') }}</td>
              <td class="product-name">{{ pr.productName }}</td>
              <td class="description-cell max-w-xs">
                <div class="line-clamp-2">{{ pr.description|default('Açıklama yok') }}</div>
              </td>
              
              <td>
                <a href="#" onclick="handleContactClick({{ pr.id }})" class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg">
                  İletişime Geç
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endif %}

<script>
  // Hover'da videoyu oynat/durdur
  var categorySection = document.getElementById('categorySection');
  document.querySelectorAll('.model-card').forEach(function(card){
    var video = card.querySelector('video');
    card.addEventListener('mouseenter', function(){
      if (video) { video.play().catch(function(){}); }
      if (categorySection) { categorySection.classList.add('is-dark'); }
    });
    card.addEventListener('mouseleave', function(){
      if (video) { video.pause(); video.currentTime = 0; }
      if (categorySection) { categorySection.classList.remove('is-dark'); }
    });
  });

  // Reveal on scroll
  function initRevealAnimations(){
    var revealItems = document.querySelectorAll('.reveal:not(.visible)');
    if (!revealItems.length) return;
    if ('IntersectionObserver' in window) {
      var observer = new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: '0px 0px -10% 0px', threshold: 0.15 });
      revealItems.forEach(function(el){ observer.observe(el); });
    } else {
      // Fallback: show immediately
      revealItems.forEach(function(el){ el.classList.add('visible'); });
    }
  }
  // İlk çalıştırma (script yüklendiğinde mevcut olanlar)
  initRevealAnimations();
  // DOM yüklendiğinde (geç gelen içerikler için)
  document.addEventListener('DOMContentLoaded', initRevealAnimations);
  // Tüm sayfa yüklendiğinde (en geç)
  window.addEventListener('load', initRevealAnimations);

  // İletişime Geç butonu kontrolü
  function handleContactClick(prId) {
    {% if app.user %}
      {% if 'ROLE_SUBSCRIBER' in app.user.roles %}
        // Firma sahibi - iletişime geç
        window.location.href = "{{ path('purchase_request_contact', {id: 1}) }}".replace('1', prId);
      {% else %}
        // Login olmuş ama firma sahibi değil - toast göster
        showToast('Sadece firma sahipleri alım talepleriyle iletişime geçebilir.', 'warning');
      {% endif %}
    {% else %}
      // Login olmamış - login sayfasına yönlendir
      window.location.href = "{{ path('app_login') }}";
    {% endif %}
  }

  // Toast mesajı gösterme fonksiyonu
  function showToast(message, type = 'info') {
    // Mevcut toast'ları temizle
    const existingToasts = document.querySelectorAll('.toast');
    existingToasts.forEach(toast => toast.remove());

    // Toast container oluştur
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
      toastContainer = document.createElement('div');
      toastContainer.id = 'toast-container';
      toastContainer.style.cssText = 'position:fixed;top:20px;right:20px;z-index:9999;';
      document.body.appendChild(toastContainer);
    }

    // Toast element oluştur
    const toast = document.createElement('div');
    toast.className = 'toast';

    const bgColor = type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6';

    toast.style.cssText = `
      background: ${bgColor};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      max-width: 400px;
      word-wrap: break-word;
    `;

    toast.textContent = message;
    toastContainer.appendChild(toast);

    // Animasyon
    setTimeout(() => {
      toast.style.transform = 'translateX(0)';
    }, 100);

    // 4 saniye sonra kaldır
    setTimeout(() => {
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 4000);
  }
</script>
<!-- Bids Section -->
<style>
  .bids-section { background:#121316; color:#e5e5e5; padding:56px 0 0; }
  .bids-shell { max-width:1600px; margin:0 auto; padding:0 20px; }
  .bids-shell { max-width:80%; margin:0 auto; padding:0 16px; }
  .bids-head { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:18px; }
  .bids-title { font-weight:800; letter-spacing:.4px; font-size:22px; }
  .bids-sub { color:#9aa0a6; font-size:13px; }
  .bids-grid { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:16px; }
  @media (max-width: 1100px) { .bids-grid { grid-template-columns: repeat(3, minmax(0,1fr)); } }
  @media (max-width: 800px) { .bids-grid { grid-template-columns: repeat(2, minmax(0,1fr)); } }
  @media (max-width: 520px) { .bids-grid { grid-template-columns: 1fr; } }
  .bid-card { position:relative; background:#141416; border:1px solid #1f2125; border-radius:12px; overflow:hidden; transition:transform .25s ease, box-shadow .25s ease; }
  .bid-card:hover { transform: translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.35); }
  .bid-media { position:relative; height:160px; background:#0a0a0a; }
  .bid-media img { width:100%; height:100%; object-fit:cover; opacity:.9; }
  .bid-body { padding:12px 14px 14px; display:flex; flex-direction:column; gap:6px; }
  .bid-company { color:#c9cdd2; font-size:12px; letter-spacing:.2px; }
  .bid-name { color:#fff; font-weight:700; font-size:14px; letter-spacing:.2px; }
  .bid-meta { display:flex; align-items:center; justify-content:space-between; color:#9aa0a6; font-size:12px; margin-top:4px; }
  .chip { padding:2px 6px; border:1px solid #2a2d32; border-radius:999px; font-size:11px; color:#c9cdd2; }
  .fade-to-footer { height:42px; background: linear-gradient(to bottom, rgba(18,19,22,0), #0a0a0a); }

  /* Purchase Requests Section */
  .purchase-requests-section {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    color:#1e293b;
    padding:64px 0;
    position:relative;
  }
  .purchase-requests-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #cbd5e1, transparent);
  }
  .purchase-requests-shell { max-width:80%; margin:0 auto; padding:0 16px; }
  .purchase-requests-head {
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    margin-bottom:24px;
  }
  .purchase-requests-title {
    font-weight:800;
    letter-spacing:.4px;
    font-size:24px;
    color:#0f172a;
    margin-bottom:4px;
  }
  .purchase-requests-sub {
    color:#64748b;
    font-size:14px;
    font-weight:500;
  }
  .purchase-requests-table {
    background:#ffffff;
    border:1px solid #e2e8f0;
    border-radius:16px;
    overflow:hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
  .purchase-requests-table table { width:100%; }
  .purchase-requests-table thead {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    border-bottom: 2px solid #e2e8f0;
  }
  .purchase-requests-table th {
    padding:16px 20px;
    text-align:left;
    font-size:12px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.8px;
    color:#475569;
    border-bottom:none;
  }
  .purchase-requests-table td {
    padding:16px 20px;
    border-bottom:1px solid #f1f5f9;
    vertical-align:top;
  }
  .purchase-requests-table tbody tr:hover {
    background:#f8fafc;
    transition: background-color 0.2s ease;
  }
  .purchase-requests-table tbody tr:last-child td { border-bottom:none; }
  .purchase-requests-table tbody tr:nth-child(even) { background:#fafbfc; }
  .purchase-requests-table tbody tr:nth-child(even):hover { background:#f1f5f9; }
  .line-clamp-2 {
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
    line-height:1.4;
  }
  .purchase-requests-table .product-name {
    font-weight:600;
    color:#0f172a;
    font-size:14px;
  }
  .purchase-requests-table .date-cell {
    color:#64748b;
    font-size:13px;
    font-weight:500;
  }
  .purchase-requests-table .description-cell {
    color:#475569;
    font-size:13px;
    line-height:1.5;
  }
  .purchase-requests-table .contact-cell {
    color:#64748b;
    font-size:12px;
    font-weight:500;
  }
  .purchase-requests-table .contact-cell div {
    margin-bottom:2px;
  }
  .purchase-requests-table .contact-cell div:last-child {
    margin-bottom:0;
  }
</style>

{% if approvedBids is defined and approvedBids|length > 0 %}
<section class="bids-section">
  <div class="bids-shell">
    <div class="bids-head">
      <div>
        <div class="bids-title">Güncel İhaleler</div>
        <div class="bids-sub">Sadece onaylanmış ilanlar listelenir</div>
      </div>
      <a href="{{ path('public_bids') }}" style="color:#c9cdd2;text-decoration:none;font-weight:600;">Tüm ihaleler →</a>
    </div>
    <div class="bids-grid">
      {% for bid in approvedBids %}
        <a href="{{ path('public_bid_detail', {'id': bid.id}) }}" style="text-decoration:none;color:inherit;display:block;">
        <article class="bid-card reveal {{ loop.index is odd ? 'from-right' : 'from-left' }}">
          <div class="bid-media">
            {% set firstImage = bid.product and bid.product.images ? bid.product.images|first : null %}
            {% if firstImage and firstImage.imagePath is defined and firstImage.imagePath %}
              <img src="{{ asset(firstImage.imagePath) }}" alt="{{ bid.product.name ?? 'Ürün' }}">
            {% else %}
              <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=1600&auto=format&fit=crop" alt="Bid">
            {% endif %}

            {# Company badge with logo and name #}
            <div style="position:absolute;top:8px;left:8px;display:flex;align-items:center;gap:8px;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);">
              {% if bid.company and bid.company.logoPath %}
                <img src="{{ asset(bid.company.logoPath) }}" alt="{{ bid.company.name }}" style="width:22px;height:22px;border-radius:999px;object-fit:cover;background:#fff;">
              {% else %}
                <div style="width:22px;height:22px;border-radius:999px;background:#e5e7eb;color:#111;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;">
                  {{ bid.company and bid.company.name ? bid.company.name|slice(0,1)|upper : 'F' }}
                </div>
              {% endif %}
              <span style="color:#fff;font-size:12px;font-weight:600;letter-spacing:.2px;max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                {{ bid.company and bid.company.name ? bid.company.name : 'Firma' }}
              </span>
            </div>
          </div>
          <div class="bid-body">
            <div class="bid-company">{{ bid.company.name ?? 'Firma' }}</div>
            <div class="bid-name">{{ bid.product.name ?? 'Ürün' }}</div>
            <div class="bid-meta">
              <span class="chip">Başlangıç: {{ bid.startingPrice ? (bid.startingPrice ~ ' ₺') : '-' }}</span>
              <span>{{ bid.endTime ? bid.endTime|date('d.m.Y H:i') : '' }}</span>
            </div>
          </div>
        </article>
        </a>
      {% endfor %}
    </div>
  </div>
  <div class="fade-to-footer"></div>
</section>
{% endif %}
{% endblock %}

{% block footer %}
<footer style="background:#0a0a0a;color:#bdbdbd;border-top:1px solid #1a1a1a;">
  <div style="max-width:80%;margin:0 auto;padding:28px 16px;">
    <!-- Ana içerik -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:24px;align-items:start;margin-bottom:20px;">
      <!-- Logo - Sol -->
      <div>
        <a href="{{ path('public_home') }}" style="display:inline-flex;align-items:center;">
          <img src="{{ asset('mineindustries_logo_transparent_pad8.png') }}" alt="Makine Ticaret" style="height:46px;width:auto;border-radius:6px;object-fit:contain;display:block;"/>
        </a>
      </div>

      <!-- İletişim - Orta -->
      <div style="font-size:13px;line-height:1.7;">
        <div style="font-weight:700;color:#e5e5e5;margin-bottom:8px;">İletişim</div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 12-9 12s-9-5-9-12a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          <span>İstanbul, Türkiye</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92V19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-2.08"/><path d="M16 3H8a2 2 0 0 0-2 2v5a6 6 0 1 0 12 0V5a2 2 0 0 0-2-2z"/></svg>
          <a href="mailto:info@makineticaret.com" style="color:#bdbdbd;text-decoration:none;">info@makineticaret.com</a>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92V21a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07A19.5 19.5 0 0 1 3.07 12.81 19.86 19.86 0 0 1 0 4.18 A2 2 0 0 1 2 2h4.09a2 2 0 0 1 2 1.72c.12.86.32 1.7.6 2.5a2 2 0 0 1-.45 2.11l-1.27 1.27a16 16 0 0 0 6.29 6.29l1.27-1.27a2 2 0 0 1 2.11-.45c.8.28 1.64.48 2.5.6A2 2 0 0 1 22 16.92z"/></svg>
          <a href="tel:+90XXXXXXXXXX" style="color:#bdbdbd;text-decoration:none;">+90 (___) ___ __ __</a>
        </div>
      </div>

      <!-- Sayfalar - Sağ -->
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
        <div style="font-weight:700;color:#e5e5e5;margin-bottom:4px;">Sayfalarımız</div>
        <nav style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;font-size:13px;">
          <a href="{{ path('public_products') }}" style="color:#bdbdbd;text-decoration:none;">Ürünler</a>
          <a href="{{ path('public_categories') }}" style="color:#bdbdbd;text-decoration:none;">Kategoriler</a>
          <a href="{{ path('public_companies') }}" style="color:#bdbdbd;text-decoration:none;">Firmalar</a>
          <a href="{{ path('public_bids') }}" style="color:#bdbdbd;text-decoration:none;">İhaleler</a>
        </nav>
      </div>
    </div>

    <!-- Alt kısım: Sosyal medya + Copyright -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #1a1a1a;">
      <div style="display:flex;gap:12px;">
        <a href="#" aria-label="Twitter" style="color:#bdbdbd;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53A4.48 4.48 0 0 0 12 7.11v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/></svg>
        </a>
        <a href="#" aria-label="LinkedIn" style="color:#bdbdbd;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
        </a>
        <a href="#" aria-label="Instagram" style="color:#bdbdbd;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg>
        </a>
      </div>
      <div style="font-size:12px;color:#7a7a7a;text-align:center;">© {{ "now"|date("Y") }} MINEINDUSTRIES. Tüm hakları saklıdır.</div>
    </div>
  </div>
</footer>
{% endblock %}


